<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research Dashboard â€” YU Intelligence</title>

    <!-- Authentication Guard - Must be first! -->
    <script src="auth.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Global Styles & Theme System -->
    <link rel="stylesheet" href="styles.css">

    <style>
        /* Page-specific dashboard styles only */

        .ios-container,
        .bento-card {
            position: relative;
            z-index: 10;
        }

        /* Dashboard-specific styles (Bento Grid and Cards) */

        /* Bento Grid Layout */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }

        /* Card Base */
        .bento-card {
            background: var(--ios-card);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
        }

        .bento-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .bento-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow:
                0 20px 40px rgba(0, 0, 0, 0.12),
                0 0 0 1px rgba(0, 122, 255, 0.1);
        }

        .bento-card:hover::before {
            left: 100%;
        }

        .bento-card:active {
            transform: translateY(-4px) scale(1.01);
        }

        /* Stats Cards */
        .stat-card {
            grid-column: span 3;
            position: relative;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            opacity: 0.05;
            border-radius: 50%;
            filter: blur(40px);
            transition: all 0.4s;
        }

        .stat-card.blue::after { background: var(--ios-blue); }
        .stat-card.pink::after { background: var(--ios-pink); }
        .stat-card.green::after { background: var(--ios-green); }
        .stat-card.purple::after { background: var(--ios-purple); }

        .stat-card:hover::after {
            opacity: 0.15;
            transform: scale(1.5);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .stat-label {
            font-size: 15px;
            color: var(--ios-secondary);
            font-weight: 500;
        }

        .stat-icon-wrapper {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .stat-card:hover .stat-icon-wrapper {
            transform: rotate(10deg) scale(1.1);
        }

        .stat-icon {
            width: 20px;
            height: 20px;
            transition: all 0.3s;
        }

        .stat-card:hover .stat-icon {
            transform: scale(1.1);
        }

        .stat-value {
            font-size: 40px;
            font-weight: 800;
            letter-spacing: -1px;
            margin-bottom: 8px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .stat-card:hover .stat-value {
            transform: scale(1.05);
            color: var(--ios-blue);
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            font-weight: 600;
        }

        .stat-trend.up { color: var(--ios-green); }
        .stat-trend.down { color: var(--ios-red); }

        /* Featured Card */
        .featured-card {
            grid-column: span 6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 280px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-size: 200% 200%;
            animation: gradient-shift 8s ease infinite;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .featured-card:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            animation: none;
        }

        .featured-title {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
            margin-bottom: 12px;
        }

        .featured-subtitle {
            font-size: 16px;
            opacity: 0.9;
            line-height: 1.5;
        }

        .featured-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 24px;
        }

        .featured-stat-item {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 16px;
        }

        .featured-stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .featured-stat-label {
            font-size: 13px;
            opacity: 0.8;
        }

        /* Chart Card */
        .chart-card {
            grid-column: span 6;
            min-height: 280px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .chart-title {
            font-size: 20px;
            font-weight: 600;
        }

        .chart-period {
            font-size: 14px;
            color: var(--ios-secondary);
        }

        .chart-bars {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            height: 180px;
            padding: 0 8px;
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(to top, var(--ios-blue), var(--ios-teal));
            border-radius: 8px 8px 0 0;
            position: relative;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
        }

        .chart-bar:hover {
            opacity: 1;
            transform: translateY(-12px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 122, 255, 0.3);
            background: linear-gradient(to top, #0051D5, var(--ios-teal));
        }

        .chart-bar-label {
            position: absolute;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: var(--ios-secondary);
            white-space: nowrap;
        }

        /* Activity Card */
        .activity-card {
            grid-column: span 4;
        }

        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .activity-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: var(--ios-grouped-bg);
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
        }

        .activity-item:hover {
            background: rgba(120, 120, 128, 0.2);
            transform: translateX(8px) scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .activity-item:hover .activity-icon {
            transform: rotate(10deg) scale(1.1);
        }

        .activity-content h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .activity-content p {
            font-size: 13px;
            color: var(--ios-secondary);
        }

        /* Channels Grid */
        .channels-card {
            grid-column: span 8;
        }

        .channels-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .channel-item {
            padding: 20px;
            background: var(--ios-grouped-bg);
            border-radius: 16px;
            text-decoration: none;
            color: inherit;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
        }

        .channel-item:hover {
            background: rgba(120, 120, 128, 0.2);
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .channel-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .channel-item:hover .channel-icon {
            transform: rotate(-10deg) scale(1.15);
        }

        .channel-name {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .channel-count {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .channel-label {
            font-size: 13px;
            color: var(--ios-secondary);
        }

        /* Universities Card */
        .universities-card {
            grid-column: span 6;
        }

        .uni-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .uni-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--ios-grouped-bg);
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
        }

        .uni-item:hover {
            background: rgba(120, 120, 128, 0.2);
            transform: translateX(6px) scale(1.03);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .uni-avatar {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .uni-item:hover .uni-avatar {
            transform: rotate(5deg) scale(1.1);
        }

        .uni-info h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .uni-info p {
            font-size: 13px;
            color: var(--ios-secondary);
        }

        /* Performance Card */
        .performance-card {
            grid-column: span 6;
        }

        .performance-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .performance-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .performance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .performance-label {
            font-size: 15px;
            font-weight: 500;
        }

        .performance-value {
            font-size: 15px;
            font-weight: 600;
            color: var(--ios-secondary);
        }

        .performance-bar {
            height: 8px;
            background: var(--ios-grouped-bg);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .performance-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -50%; }
            100% { left: 150%; }
        }

        .performance-fill {
            height: 100%;
            border-radius: 4px;
            transition: all 1s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            z-index: 1;
        }

        .performance-card:hover .performance-fill {
            transform: scaleY(1.5);
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 60px 0;
            min-height: 50vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--ios-separator);
            border-top-color: var(--ios-text);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Bottom Navigation Bar - Mobile Only */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 68px;
            background: var(--glass-bg-solid);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            border-top: 0.33px solid var(--ios-separator);
            z-index: 100;
            display: none;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .bottom-nav-content {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 100%;
            max-width: 100%;
            margin: 0 auto;
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            flex: 1;
            height: 100%;
            text-decoration: none;
            color: var(--ios-secondary);
            transition: color 0.2s;
            position: relative;
        }

        .bottom-nav-item.active {
            color: var(--ios-blue);
        }

        .bottom-nav-item svg {
            width: 24px;
            height: 24px;
        }

        .bottom-nav-item span {
            font-size: 10px;
            font-weight: 500;
            letter-spacing: -0.08px;
        }

        .bottom-nav-badge {
            position: absolute;
            top: 8px;
            right: 50%;
            transform: translateX(12px);
            min-width: 16px;
            height: 16px;
            background: var(--ios-red);
            color: white;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .stat-card { grid-column: span 6; }
            .featured-card { grid-column: span 12; }
            .chart-card { grid-column: span 12; }
            .activity-card { grid-column: span 6; }
            .channels-card { grid-column: span 12; }
            .universities-card { grid-column: span 12; }
            .performance-card { grid-column: span 12; }
        }

        @media (max-width: 768px) {
            .stat-card { grid-column: span 12; }
            .channels-grid { grid-template-columns: 1fr; }
            .uni-grid { grid-template-columns: 1fr; }

            /* Show bottom nav on mobile */
            .bottom-nav {
                display: block;
            }

            /* Hide sidebar toggle button on mobile */
            .nav-icon-btn:first-child {
                display: none;
            }

            /* Adjust iOS container padding for mobile */
            .ios-container {
                padding: 32px 20px 88px;
            }

            .ios-nav-content {
                padding: 0 20px;
            }
        }

        /* Hidden Widget Style */
        .hidden {
            display: none !important;
        }

        /* Customization Mode Styles */
        .customize-btn {
            padding: 6px 16px;
            background: var(--ios-blue);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .customize-btn:hover {
            background: #0051D5;
            transform: scale(1.05);
        }

        .customize-btn.active {
            background: var(--ios-green);
        }

        .customize-btn svg {
            width: 16px;
            height: 16px;
        }

        /* Edit Mode Overlay */
        .edit-mode-banner {
            position: fixed;
            top: 88px;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--ios-blue), var(--ios-purple));
            color: white;
            padding: 12px 20px;
            text-align: center;
            z-index: 99;
            display: none;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .edit-mode-banner.show {
            display: block;
        }

        /* Customization Panel */
        .customize-panel {
            position: fixed;
            right: -380px;
            top: 0;
            width: 380px;
            height: 100vh;
            background: var(--glass-bg-panel);
            backdrop-filter: saturate(180%) blur(20px);
            border-left: 0.33px solid var(--ios-separator);
            z-index: 150;
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            overflow-x: hidden;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.1);
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }

        .customize-panel.open {
            right: 0;
        }

        /* Panel Overlay */
        .customize-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.2);
            z-index: 149;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .customize-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        /* Floating Toggle Button */
        .floating-panel-btn {
            position: fixed;
            right: 24px;
            bottom: 100px;
            width: 56px;
            height: 56px;
            background: var(--ios-blue);
            color: white;
            border: none;
            border-radius: 28px;
            box-shadow: 0 8px 24px rgba(0, 122, 255, 0.4);
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 148;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .floating-panel-btn.show {
            display: flex;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 8px 24px rgba(0, 122, 255, 0.4);
            }
            50% {
                box-shadow: 0 8px 32px rgba(0, 122, 255, 0.7), 0 0 0 8px rgba(0, 122, 255, 0.2);
            }
        }

        .floating-panel-btn:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 12px 32px rgba(0, 122, 255, 0.6);
            animation: none;
        }

        .floating-panel-btn:active {
            transform: scale(0.95);
        }

        .floating-panel-btn svg {
            width: 24px;
            height: 24px;
        }

        .customize-panel-header {
            padding: 24px;
            border-bottom: 0.33px solid var(--ios-separator);
            position: sticky;
            top: 0;
            background: var(--glass-bg-panel);
            backdrop-filter: saturate(180%) blur(20px);
            z-index: 1;
        }

        .customize-panel-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .customize-panel-subtitle {
            font-size: 14px;
            color: var(--ios-secondary);
        }

        .customize-panel-content {
            padding: 24px;
            padding-bottom: 100px; /* Extra space for scrolling */
            min-height: calc(100vh - 100px);
        }

        .customize-section {
            margin-bottom: 32px;
        }

        .customize-section-title {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--ios-secondary);
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }

        .widget-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: var(--ios-card);
            border-radius: 12px;
            margin-bottom: 8px;
            transition: all 0.2s;
        }

        .widget-toggle:hover {
            background: var(--ios-grouped-bg);
        }

        .widget-toggle-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .widget-toggle-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--ios-grouped-bg);
        }

        .widget-toggle-text h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .widget-toggle-text p {
            font-size: 12px;
            color: var(--ios-secondary);
        }

        /* iOS Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 51px;
            height: 31px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--ios-grouped-bg);
            transition: 0.3s;
            border-radius: 31px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 27px;
            width: 27px;
            left: 2px;
            bottom: 2px;
            background-color: var(--bg-secondary);
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: var(--ios-green);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        /* Size Selector */
        .size-selector {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .size-btn {
            flex: 1;
            padding: 8px;
            background: var(--ios-card);
            border: 1.5px solid var(--ios-separator);
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .size-btn:hover {
            background: var(--ios-grouped-bg);
        }

        .size-btn.active {
            background: var(--ios-blue);
            color: white;
            border-color: var(--ios-blue);
        }

        /* Action Buttons */
        .customize-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .btn-reset {
            flex: 1;
            padding: 12px;
            background: var(--ios-red);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-reset:hover {
            opacity: 0.8;
        }

        .btn-save {
            flex: 1;
            padding: 12px;
            background: var(--ios-blue);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-save:hover {
            opacity: 0.8;
        }

        /* Draggable Cards in Edit Mode */
        .edit-mode .bento-card {
            cursor: move;
            position: relative;
            transition: all 0.3s;
        }

        .edit-mode .bento-card:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            z-index: 5;
        }

        .edit-mode .bento-card::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            width: 24px;
            height: 24px;
            background: rgba(0, 122, 255, 0.15);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .edit-mode .bento-card::after {
            content: 'â‹®â‹®';
            position: absolute;
            top: 12px;
            left: 14px;
            font-size: 14px;
            color: var(--ios-blue);
            font-weight: 900;
            letter-spacing: -2px;
        }

        .bento-card.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .bento-card.hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .customize-panel {
                width: 100%;
                right: -100%;
            }

            .customize-btn {
                font-size: 12px;
                padding: 6px 12px;
            }

            .floating-panel-btn {
                bottom: 88px;
                right: 16px;
                width: 48px;
                height: 48px;
            }
        }
    </style>
</head>
<body>

    <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

    <aside class="ios-sidebar" id="ios-sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <div class="logo-icon">
                    <svg width="20" height="20" viewBox="0 0 32 32" fill="none">
                        <path d="M16 8L10 12L16 16L22 12L16 8Z" stroke="white" stroke-width="1.5"/>
                        <path d="M10 20L16 24L22 20" stroke="white" stroke-width="1.5"/>
                        <path d="M10 16L16 20L22 16" stroke="white" stroke-width="1.5"/>
                    </svg>
                </div>
                <div class="logo-text">
                    <h1>Yeshiva University</h1>
                    <p>Research Intelligence</p>
                </div>
            </div>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-label">Overview</div>
                <a href="elegant-bento.html" class="sidebar-nav-item active">Dashboard</a>
                <a href="analytics.html" class="sidebar-nav-item">Analytics</a>
            </div>

            <div class="nav-section">
                <div class="nav-section-label">Communications</div>
                <a href="internal-comms.html" class="sidebar-nav-item">Internal Comms</a>
                <a href="audience-segmentation.html" class="sidebar-nav-item">Audience</a>
                <a href="channels-management.html" class="sidebar-nav-item">Channels</a>
                <a href="moderation.html" class="sidebar-nav-item">Moderation</a>
                <a href="compliance-visual.html" class="sidebar-nav-item">Compliance</a>
                <a href="feedback.html" class="sidebar-nav-item">Feedback</a>
                <a href="insights.html" class="sidebar-nav-item">Insights</a>
            </div>

            <div class="nav-section">
                <div class="nav-section-label">Channels</div>
                <a href="social-posts.html" class="sidebar-nav-item">
                    <span>Social Media</span>
                    <div class="nav-item-badge" id="social-badge">50</div>
                </a>
                <a href="email-marketing.html" class="sidebar-nav-item">
                    <span>Email Marketing</span>
                    <div class="nav-item-badge">72</div>
                </a>
                <a href="digital-ads.html" class="sidebar-nav-item">
                    <span>Digital Ads</span>
                    <div class="nav-item-badge">20</div>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-label">Research</div>
                <a href="universities.html" class="sidebar-nav-item">Universities</a>
                <a href="research-files.html" class="sidebar-nav-item">Files</a>
                <a href="reports.html" class="sidebar-nav-item">Reports</a>
                <a href="settings.html" class="sidebar-nav-item">Settings</a>
            </div>
        </nav>

        <div class="sidebar-footer">
            <div class="sidebar-status">
                <div class="status-dot"></div>
                <div class="status-text">Connected</div>
            </div>
            <div style="display: flex; gap: 8px; width: 100%;">
                <button class="btn-export" style="flex: 1;">Export Data</button>
                <button class="btn-export" onclick="logout()" style="flex: 1; background: linear-gradient(135deg, #FF3B30 0%, #FF6B6B 100%);">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16 17 21 12 16 7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                    Logout
                </button>
            </div>
        </div>
    </aside>

    <nav class="ios-nav">
        <div class="ios-nav-content">
            <div class="ios-nav-top">
                <button class="nav-icon-btn" onclick="toggleSidebar()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12"/>
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <line x1="3" y1="18" x2="21" y2="18"/>
                    </svg>
                </button>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <!-- Dark Mode Toggle -->
                    <div class="theme-toggle" id="themeToggle" onclick="ThemeManager.toggleTheme()">
                        <div class="theme-toggle-slider">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="5"/>
                                <line x1="12" y1="1" x2="12" y2="3"/>
                                <line x1="12" y1="21" x2="12" y2="23"/>
                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                                <line x1="1" y1="12" x2="3" y2="12"/>
                                <line x1="21" y1="12" x2="23" y2="12"/>
                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                            </svg>
                        </div>
                    </div>

                    <button class="customize-btn" id="customizeBtn" onclick="toggleCustomize()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6m0 6v6m5.196-12.196l-4.243 4.243m0 5.657l-4.242 4.242m12.02-11.313l-4.243 4.243m0 5.657l-4.242 4.242M23 12h-6m-6 0H1"/>
                        </svg>
                        <span>Customize</span>
                    </button>
                    <button class="nav-icon-btn" onclick="loadData()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"/>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="ios-large-title">Research Dashboard</div>
        </div>
    </nav>

    <!-- Edit Mode Banner -->
    <div class="edit-mode-banner" id="editModeBanner">
        ðŸŽ¨ Drag & drop cards to rearrange â€¢ Use the panel to customize your dashboard
    </div>

    <!-- Customize Panel Overlay -->
    <div class="customize-overlay" id="customizeOverlay" onclick="togglePanel()"></div>

    <!-- Floating Panel Toggle Button -->
    <button class="floating-panel-btn" id="floatingPanelBtn" onclick="togglePanel()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M12 1v6m0 6v6m5.196-12.196l-4.243 4.243m0 5.657l-4.242 4.242m12.02-11.313l-4.243 4.243m0 5.657l-4.242 4.242M23 12h-6m-6 0H1"/>
        </svg>
    </button>

    <!-- Customization Panel -->
    <aside class="customize-panel" id="customizePanel">
        <div class="customize-panel-header">
            <div class="customize-panel-title">Customize Dashboard</div>
            <div class="customize-panel-subtitle">Show, hide and rearrange widgets</div>
        </div>

        <div class="customize-panel-content">
            <div class="customize-section">
                <div class="customize-section-title">Statistics</div>

                <div class="widget-toggle">
                    <div class="widget-toggle-info">
                        <div class="widget-toggle-icon" style="background: rgba(0, 122, 255, 0.1);">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#007AFF" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                            </svg>
                        </div>
                        <div class="widget-toggle-text">
                            <h4>Stats Cards</h4>
                            <p>Show platform statistics</p>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" checked onchange="toggleWidget('stats-cards', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="customize-section">
                <div class="customize-section-title">Main Content</div>

                <div class="widget-toggle">
                    <div class="widget-toggle-info">
                        <div class="widget-toggle-icon" style="background: rgba(103, 126, 234, 0.1);">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2">
                                <rect x="2" y="2" width="20" height="20" rx="5"/>
                            </svg>
                        </div>
                        <div class="widget-toggle-text">
                            <h4>Featured Card</h4>
                            <p>Intelligence overview</p>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" checked onchange="toggleWidget('featured-card', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="widget-toggle">
                    <div class="widget-toggle-info">
                        <div class="widget-toggle-icon" style="background: rgba(0, 122, 255, 0.1);">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#007AFF" stroke-width="2">
                                <line x1="18" y1="20" x2="18" y2="10"/>
                                <line x1="12" y1="20" x2="12" y2="4"/>
                                <line x1="6" y1="20" x2="6" y2="14"/>
                            </svg>
                        </div>
                        <div class="widget-toggle-text">
                            <h4>Activity Chart</h4>
                            <p>Weekly performance</p>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" checked onchange="toggleWidget('chart-card', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="widget-toggle">
                    <div class="widget-toggle-info">
                        <div class="widget-toggle-icon" style="background: rgba(175, 82, 222, 0.1);">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#AF52DE" stroke-width="2">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                            </svg>
                        </div>
                        <div class="widget-toggle-text">
                            <h4>Recent Activity</h4>
                            <p>Latest updates</p>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" checked onchange="toggleWidget('activity-card', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="widget-toggle">
                    <div class="widget-toggle-info">
                        <div class="widget-toggle-icon" style="background: rgba(255, 45, 85, 0.1);">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#FF2D55" stroke-width="2">
                                <rect x="2" y="2" width="20" height="20" rx="5"/>
                                <circle cx="12" cy="12" r="4"/>
                            </svg>
                        </div>
                        <div class="widget-toggle-text">
                            <h4>Social Channels</h4>
                            <p>Platform cards</p>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" checked onchange="toggleWidget('channels-card', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="widget-toggle">
                    <div class="widget-toggle-info">
                        <div class="widget-toggle-icon" style="background: rgba(52, 199, 89, 0.1);">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#34C759" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                            </svg>
                        </div>
                        <div class="widget-toggle-text">
                            <h4>Universities</h4>
                            <p>Network grid</p>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" checked onchange="toggleWidget('universities-card', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="widget-toggle">
                    <div class="widget-toggle-info">
                        <div class="widget-toggle-icon" style="background: rgba(255, 149, 0, 0.1);">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#FF9500" stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"/>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                        </div>
                        <div class="widget-toggle-text">
                            <h4>Performance</h4>
                            <p>Platform metrics</p>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" checked onchange="toggleWidget('performance-card', this.checked)">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="customize-actions">
                <button class="btn-reset" onclick="resetDashboard()">Reset</button>
                <button class="btn-save" onclick="saveCustomization()">Done</button>
            </div>
        </div>
    </aside>

    <div class="ios-container">

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div>Loading data...</div>
        </div>

        <div id="dashboard" style="display: none;">

            <!-- Stats Row -->
            <div class="bento-grid" id="stats-cards">
                <div class="bento-card stat-card blue" data-widget-id="stats-cards" draggable="false">
                    <div class="stat-header">
                        <span class="stat-label">Total Posts</span>
                        <div class="stat-icon-wrapper" style="background: rgba(0, 122, 255, 0.1);">
                            <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <line x1="9" y1="9" x2="15" y2="9"/>
                                <line x1="9" y1="15" x2="15" y2="15"/>
                            </svg>
                        </div>
                    </div>
                    <div class="stat-value" id="stat-total">50</div>
                    <div class="stat-trend up">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                        </svg>
                        Facebook posts
                    </div>
                </div>

                <div class="bento-card stat-card pink">
                    <div class="stat-header">
                        <span class="stat-label">Instagram</span>
                        <div class="stat-icon-wrapper" style="background: rgba(225, 48, 108, 0.1);">
                            <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="2" width="20" height="20" rx="5"/>
                                <circle cx="12" cy="12" r="4"/>
                            </svg>
                        </div>
                    </div>
                    <div class="stat-value" id="stat-instagram">50</div>
                    <div class="stat-trend up">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                        </svg>
                        1.50% engagement
                    </div>
                </div>

                <div class="bento-card stat-card green">
                    <div class="stat-header">
                        <span class="stat-label">Facebook</span>
                        <div class="stat-icon-wrapper" style="background: rgba(24, 119, 242, 0.1);">
                            <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
                            </svg>
                        </div>
                    </div>
                    <div class="stat-value" id="stat-facebook">50</div>
                    <div class="stat-trend">Community posts</div>
                </div>

                <div class="bento-card stat-card purple">
                    <div class="stat-header">
                        <span class="stat-label">Twitter</span>
                        <div class="stat-icon-wrapper" style="background: rgba(29, 161, 242, 0.1);">
                            <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
                            </svg>
                        </div>
                    </div>
                    <div class="stat-value" id="stat-twitter">8</div>
                    <div class="stat-trend up">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                        </svg>
                        0.80% engagement
                    </div>
                </div>
            </div>

            <!-- Featured & Chart Row -->
            <div class="bento-grid">
                <div class="bento-card featured-card" data-widget-id="featured-card" draggable="false">
                    <div>
                        <div class="featured-title">Social Media Intelligence</div>
                        <div class="featured-subtitle">Real-time monitoring and analysis of university social media presence across multiple platforms</div>
                    </div>
                    <div class="featured-stats">
                        <div class="featured-stat-item">
                            <div class="featured-stat-value" id="feat-engagement">15,237</div>
                            <div class="featured-stat-label">Total Engagement</div>
                        </div>
                        <div class="featured-stat-item">
                            <div class="featured-stat-value">5</div>
                            <div class="featured-stat-label">Universities</div>
                        </div>
                        <div class="featured-stat-item">
                            <div class="featured-stat-value">21</div>
                            <div class="featured-stat-label">Active Ads</div>
                        </div>
                    </div>
                </div>

                <div class="bento-card chart-card" data-widget-id="chart-card" draggable="false">
                    <div class="chart-header">
                        <div class="chart-title">Weekly Activity</div>
                        <div class="chart-period">Last 7 days</div>
                    </div>
                    <div class="chart-bars">
                        <div class="chart-bar" style="height: 45%;">
                            <div class="chart-bar-label">Mon</div>
                        </div>
                        <div class="chart-bar" style="height: 65%;">
                            <div class="chart-bar-label">Tue</div>
                        </div>
                        <div class="chart-bar" style="height: 55%;">
                            <div class="chart-bar-label">Wed</div>
                        </div>
                        <div class="chart-bar" style="height: 80%;">
                            <div class="chart-bar-label">Thu</div>
                        </div>
                        <div class="chart-bar" style="height: 70%;">
                            <div class="chart-bar-label">Fri</div>
                        </div>
                        <div class="chart-bar" style="height: 40%;">
                            <div class="chart-bar-label">Sat</div>
                        </div>
                        <div class="chart-bar" style="height: 35%;">
                            <div class="chart-bar-label">Sun</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Activity & Channels Row -->
            <div class="bento-grid">
                <div class="bento-card activity-card" data-widget-id="activity-card" draggable="false">
                    <div class="card-title">Recent Activity</div>
                    <div class="activity-list">
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                                </svg>
                            </div>
                            <div class="activity-content">
                                <h4>Data Updated</h4>
                                <p>Instagram posts synchronized</p>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                </svg>
                            </div>
                            <div class="activity-content">
                                <h4>New Report</h4>
                                <p>Q4 analysis available</p>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12 6 12 12 16 14"/>
                                </svg>
                            </div>
                            <div class="activity-content">
                                <h4>Scheduled Scan</h4>
                                <p>Twitter data collection</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bento-card channels-card" data-widget-id="channels-card" draggable="false">
                    <div class="card-title">Social Channels</div>
                    <div class="channels-grid">
                        <a href="social-posts.html" class="channel-item">
                            <div class="channel-icon" style="background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                    <rect x="2" y="2" width="20" height="20" rx="5"/>
                                    <circle cx="12" cy="12" r="4"/>
                                </svg>
                            </div>
                            <div class="channel-name">Instagram</div>
                            <div class="channel-count" id="channel-instagram">0</div>
                            <div class="channel-label">No data</div>
                        </a>

                        <a href="social-posts.html" class="channel-item">
                            <div class="channel-icon" style="background: #1877F2;">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                    <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
                                </svg>
                            </div>
                            <div class="channel-name">Facebook</div>
                            <div class="channel-count" id="channel-facebook">50</div>
                            <div class="channel-label">Posts</div>
                        </a>

                        <a href="social-posts.html" class="channel-item">
                            <div class="channel-icon" style="background: #1DA1F2;">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
                                </svg>
                            </div>
                            <div class="channel-name">Twitter</div>
                            <div class="channel-count" id="channel-twitter">0</div>
                            <div class="channel-label">No data</div>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Universities & Performance Row -->
            <div class="bento-grid">
                <div class="bento-card universities-card" data-widget-id="universities-card" draggable="false">
                    <div class="card-title">Universities Network</div>
                    <div class="uni-grid">
                        <div class="uni-item">
                            <div class="uni-avatar" style="background: linear-gradient(135deg, #000 0%, #434343 100%);">YU</div>
                            <div class="uni-info">
                                <h4>Yeshiva University</h4>
                                <p>Primary</p>
                            </div>
                        </div>
                        <div class="uni-item">
                            <div class="uni-avatar" style="background: linear-gradient(135deg, #003478 0%, #1a5fa8 100%);">BR</div>
                            <div class="uni-info">
                                <h4>Brandeis University</h4>
                                <p>Tracking</p>
                            </div>
                        </div>
                        <div class="uni-item">
                            <div class="uni-avatar" style="background: linear-gradient(135deg, #57068c 0%, #8a2be2 100%);">NY</div>
                            <div class="uni-info">
                                <h4>New York University</h4>
                                <p>Tracking</p>
                            </div>
                        </div>
                        <div class="uni-item">
                            <div class="uni-avatar" style="background: linear-gradient(135deg, #9BDDFF 0%, #5AB3E8 100%);">CU</div>
                            <div class="uni-info">
                                <h4>Columbia University</h4>
                                <p>Tracking</p>
                            </div>
                        </div>
                        <div class="uni-item">
                            <div class="uni-avatar" style="background: linear-gradient(135deg, #1e4d2b 0%, #2d7a3e 100%);">TO</div>
                            <div class="uni-info">
                                <h4>Touro University</h4>
                                <p>Tracking</p>
                            </div>
                        </div>
                        <div class="uni-item">
                            <div class="uni-avatar" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">+</div>
                            <div class="uni-info">
                                <h4>Add University</h4>
                                <p>Expand network</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bento-card performance-card" data-widget-id="performance-card" draggable="false">
                    <div class="card-title">Platform Performance</div>
                    <div class="performance-list">
                        <div class="performance-item">
                            <div class="performance-header">
                                <span class="performance-label">Facebook Posts</span>
                                <span class="performance-value">50 posts</span>
                            </div>
                            <div class="performance-bar">
                                <div class="performance-fill" style="width: 100%; background: #1877F2;"></div>
                            </div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-header">
                                <span class="performance-label">Total Engagement</span>
                                <span class="performance-value">4,260</span>
                            </div>
                            <div class="performance-bar">
                                <div class="performance-fill" style="width: 85%; background: linear-gradient(90deg, #f09433, #dc2743);"></div>
                            </div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-header">
                                <span class="performance-label">Avg Engagement Rate</span>
                                <span class="performance-value">0.60%</span>
                            </div>
                            <div class="performance-bar">
                                <div class="performance-fill" style="width: 60%; background: var(--ios-green);"></div>
                            </div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-header">
                                <span class="performance-label">Active Meta Ads</span>
                                <span class="performance-value">20 ads</span>
                            </div>
                            <div class="performance-bar">
                                <div class="performance-fill" style="width: 100%; background: linear-gradient(90deg, var(--ios-purple), var(--ios-teal));"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Bottom Navigation - Mobile Only -->
        <nav class="bottom-nav">
        <div class="bottom-nav-content">
            <a href="elegant-bento.html" class="bottom-nav-item active">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7" rx="1"/>
                    <rect x="14" y="3" width="7" height="7" rx="1"/>
                    <rect x="14" y="14" width="7" height="7" rx="1"/>
                    <rect x="3" y="14" width="7" height="7" rx="1"/>
                </svg>
                <span>Dashboard</span>
            </a>

            <a href="social-posts.html" class="bottom-nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="2" width="20" height="20" rx="5"/>
                    <circle cx="12" cy="12" r="4"/>
                    <circle cx="18" cy="6" r="1" fill="currentColor"/>
                </svg>
                <span>Social</span>
            </a>

            <a href="digital-ads.html" class="bottom-nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/>
                    <line x="7" y="2" x2="7" y2="22"/>
                    <line x="17" y="2" x2="17" y2="22"/>
                    <line x="2" y="12" x2="22" y2="12"/>
                </svg>
                <span>Ads</span>
            </a>

            <a href="email-marketing.html" class="bottom-nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                    <polyline points="22,6 12,13 2,6"/>
                </svg>
                <span>Email</span>
            </a>

            <a href="research-files.html" class="bottom-nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                    <polyline points="13 2 13 9 20 9"/>
                </svg>
                <span>Files</span>
            </a>
        </div>
    </nav>

    <script>
        // Backend API configuration
        const API_BASE = 'https://nomassi-1.onrender.com';

        function toggleSidebar() {
            document.getElementById('ios-sidebar').classList.toggle('open');
            document.getElementById('sidebar-overlay').classList.toggle('show');
        }

        async function loadData() {
            const loading = document.getElementById('loading');
            const dashboard = document.getElementById('dashboard');

            loading.style.display = 'block';
            dashboard.style.display = 'none';

            try {
                // Fetch real data from backend
                const [facebook, ads, universities] = await Promise.all([
                    fetch(`${API_BASE}/api/facebook/yeshivauniversity`).then(r => r.json()).catch(() => []),
                    fetch(`${API_BASE}/api/meta-ads/yeshiva_university`).then(r => r.json()).catch(() => []),
                    fetch(`${API_BASE}/api/universities`).then(r => r.json()).catch(() => ({ universities: [] }))
                ]);

                // Calculate real metrics from Facebook posts
                const fbCount = facebook?.length || 0;
                const totalEngagement = facebook.reduce((sum, post) =>
                    sum + (post.likes || 0) + (post.comments || 0) + (post.shares || 0), 0);
                const avgEngagementRate = facebook.length > 0 ?
                    facebook.reduce((sum, post) => sum + parseFloat(post.engagement_rate || 0), 0) / facebook.length : 0;

                // Count active ads
                const activeAds = ads.filter(ad => ad.is_active === true).length;
                const totalUniversities = universities.universities?.length || 5;

                // Update stats with real data
                document.getElementById('stat-total').textContent = fbCount;
                document.getElementById('stat-instagram').textContent = '50'; // Real Instagram posts
                document.getElementById('stat-facebook').textContent = fbCount;
                document.getElementById('stat-twitter').textContent = '8'; // Real Twitter posts

                // Update channels
                document.getElementById('channel-instagram').textContent = '50';
                document.getElementById('channel-facebook').textContent = fbCount;
                document.getElementById('channel-twitter').textContent = '8';

                // Update featured stats
                document.getElementById('feat-engagement').textContent = totalEngagement.toLocaleString();

                // Update badges
                const badge = document.getElementById('social-badge');
                if (badge) badge.textContent = fbCount;

                const mobileBadge = document.getElementById('mobile-social-badge');
                if (mobileBadge) mobileBadge.textContent = fbCount;

                loading.style.display = 'none';
                dashboard.style.display = 'block';

                console.log('Data loaded:', { fbCount, totalEngagement, avgEngagementRate: avgEngagementRate.toFixed(2), activeAds, totalUniversities });

            } catch (error) {
                console.error('Error:', error);
                loading.innerHTML = '<div style="color: var(--ios-red);">Failed to load data. Using offline data.</div>';
                // Show dashboard anyway with offline data
                setTimeout(() => {
                    loading.style.display = 'none';
                    dashboard.style.display = 'block';
                }, 2000);
            }
        }

        window.addEventListener('DOMContentLoaded', loadData);

        // ============================================
        // CUSTOMIZATION & DRAG & DROP FUNCTIONALITY
        // ============================================

        let isEditMode = false;
        let isPanelOpen = false;
        let draggedElement = null;

        // Toggle Customize Mode
        function toggleCustomize() {
            isEditMode = !isEditMode;
            const customizeBtn = document.getElementById('customizeBtn');
            const customizePanel = document.getElementById('customizePanel');
            const customizeOverlay = document.getElementById('customizeOverlay');
            const floatingBtn = document.getElementById('floatingPanelBtn');
            const editBanner = document.getElementById('editModeBanner');
            const dashboard = document.getElementById('dashboard');

            if (isEditMode) {
                customizeBtn.classList.add('active');
                customizeBtn.querySelector('span').textContent = 'Done';
                customizePanel.classList.add('open');
                customizeOverlay.classList.add('show');
                editBanner.classList.add('show');
                dashboard.classList.add('edit-mode');
                isPanelOpen = true;
                enableDragDrop();
            } else {
                customizeBtn.classList.remove('active');
                customizeBtn.querySelector('span').textContent = 'Customize';
                customizePanel.classList.remove('open');
                customizeOverlay.classList.remove('show');
                floatingBtn.classList.remove('show');
                editBanner.classList.remove('show');
                dashboard.classList.remove('edit-mode');
                isPanelOpen = false;
                disableDragDrop();
            }
        }

        // Toggle Panel (without exiting edit mode)
        function togglePanel() {
            if (!isEditMode) return;

            const customizePanel = document.getElementById('customizePanel');
            const customizeOverlay = document.getElementById('customizeOverlay');
            const floatingBtn = document.getElementById('floatingPanelBtn');

            isPanelOpen = !isPanelOpen;

            if (isPanelOpen) {
                customizePanel.classList.add('open');
                customizeOverlay.classList.add('show');
                floatingBtn.classList.remove('show');
            } else {
                customizePanel.classList.remove('open');
                customizeOverlay.classList.remove('show');
                floatingBtn.classList.add('show');
            }
        }

        // Enable Drag & Drop
        function enableDragDrop() {
            const cards = document.querySelectorAll('.bento-card[data-widget-id]');
            cards.forEach(card => {
                card.setAttribute('draggable', 'true');
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragover', handleDragOver);
                card.addEventListener('drop', handleDrop);
                card.addEventListener('dragend', handleDragEnd);
            });
        }

        // Disable Drag & Drop
        function disableDragDrop() {
            const cards = document.querySelectorAll('.bento-card[data-widget-id]');
            cards.forEach(card => {
                card.setAttribute('draggable', 'false');
                card.removeEventListener('dragstart', handleDragStart);
                card.removeEventListener('dragover', handleDragOver);
                card.removeEventListener('drop', handleDrop);
                card.removeEventListener('dragend', handleDragEnd);
            });
        }

        // Drag Handlers
        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';

            const afterElement = getDragAfterElement(this.parentElement, e.clientY);
            const dragging = document.querySelector('.dragging');

            if (afterElement == null) {
                this.parentElement.appendChild(dragging);
            } else {
                this.parentElement.insertBefore(dragging, afterElement);
            }

            return false;
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }

            if (draggedElement !== this) {
                const parent = this.parentElement;
                const draggedIndex = Array.from(parent.children).indexOf(draggedElement);
                const targetIndex = Array.from(parent.children).indexOf(this);

                if (draggedIndex < targetIndex) {
                    parent.insertBefore(draggedElement, this.nextSibling);
                } else {
                    parent.insertBefore(draggedElement, this);
                }
            }

            return false;
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');

            const cards = document.querySelectorAll('.bento-card[data-widget-id]');
            cards.forEach(card => {
                card.classList.remove('over');
            });

            saveDashboardLayout();
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.bento-card:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;

                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Toggle Widget Visibility
        function toggleWidget(widgetId, show) {
            // Try to find by data-widget-id first, then by id
            let widget = document.querySelector(`[data-widget-id="${widgetId}"]`);
            if (!widget) {
                widget = document.getElementById(widgetId);
            }
            
            if (widget) {
                if (show) {
                    widget.classList.remove('hidden');
                } else {
                    widget.classList.add('hidden');
                }
                saveWidgetPreferences();
            }
        }

        // Save Customization
        function saveCustomization() {
            saveDashboardLayout();
            saveWidgetPreferences();

            // Close panel but keep edit mode
            togglePanel();

            // Show success message
            const banner = document.getElementById('editModeBanner');
            const originalText = banner.textContent;
            banner.textContent = 'âœ… Dashboard customization saved!';
            banner.classList.add('show');
            setTimeout(() => {
                banner.textContent = originalText;
            }, 2000);
        }

        // Save Dashboard Layout
        function saveDashboardLayout() {
            const grids = document.querySelectorAll('.bento-grid');
            const layout = {};

            grids.forEach((grid, gridIndex) => {
                const cards = grid.querySelectorAll('.bento-card[data-widget-id]');
                layout[`grid-${gridIndex}`] = Array.from(cards).map(card => card.dataset.widgetId);
            });

            localStorage.setItem('dashboardLayout', JSON.stringify(layout));
        }

        // Save Widget Preferences
        function saveWidgetPreferences() {
            const widgets = {};
            const toggles = document.querySelectorAll('.widget-toggle input[type="checkbox"]');

            toggles.forEach(toggle => {
                const widgetId = toggle.getAttribute('onchange').match(/'([^']+)'/)[1];
                widgets[widgetId] = toggle.checked;
            });

            localStorage.setItem('widgetPreferences', JSON.stringify(widgets));
        }

        // Load Saved Preferences
        function loadSavedPreferences() {
            const widgetPrefs = localStorage.getItem('widgetPreferences');

            if (widgetPrefs) {
                const preferences = JSON.parse(widgetPrefs);

                Object.keys(preferences).forEach(widgetId => {
                    const widget = document.querySelector(`[data-widget-id="${widgetId}"]`);
                    const toggle = document.querySelector(`input[onchange*="${widgetId}"]`);

                    if (widget && toggle) {
                        if (preferences[widgetId]) {
                            widget.classList.remove('hidden');
                            toggle.checked = true;
                        } else {
                            widget.classList.add('hidden');
                            toggle.checked = false;
                        }
                    }
                });
            }
        }

        // Reset Dashboard
        function resetDashboard() {
            if (confirm('Are you sure you want to reset the dashboard to default layout?')) {
                localStorage.removeItem('dashboardLayout');
                localStorage.removeItem('widgetPreferences');
                location.reload();
            }
        }

        // Load preferences on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadSavedPreferences();
        });
    </script>

    <!-- Theme System -->
    <script src="theme.js"></script>

</body>
</html>
